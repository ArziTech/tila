// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

enum TodoStatus {
  ONGOING
  ARCHIVED
  COMPLETED
  CANCELED
  CONTINUE_LATER
}

enum BadgeCategory {
  MILESTONES
  STREAKS
  POINTS
  DIVERSITY
  DIFFICULTY
  SPECIAL
}
model Account {
  id                       String  @id @default(cuid())
  userId                   String  @unique
  type                     String
  provider                 String
  providerAccountId        String
  refresh_token            String? @db.Text
  access_token             String? @db.Text
  expires_at               Int?
  token_type               String?
  scope                    String?
  id_token                 String? @db.Text
  session_state            String?
  refresh_token_expires_in Int?
  user                     User?   @relation(fields: [userId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([provider, providerAccountId])
  @@index([userId])
}
model User {
  id           String   @id @default(uuid())
  name         String?
  email        String         @unique
  username     String
  password     String?
  image        String?

  total_points   Int     @default(0)
  current_streak Int    @default(0)
  longest_streak Int    @default(0)
  learnings         Int    @default(0)
  uniqueCategories  Int    @default(0)
  advancedCount     Int    @default(0)
  intermediateCount Int    @default(0)
  beginnerCount     Int    @default(0)

  items        Item[]
  todos        Todo[]
  categories   Category[]
  dailyActivities DailyActivity[]
  accounts     Account[]
  earnedBadges UserBadge[]

  emailVerified            DateTime?
  verificationToken        String?  @unique
  verificationTokenExpires DateTime?
  last_activity_date       DateTime?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
}

model Category {
  id          String   @id @default(uuid())
  name        String
  color       String
  items       Item[]
  todos       Todo[]
  user     User  @relation(fields: [userId], references: [id])
  userId   String
}

model Item {
  id               String   @id @default(uuid())
  title            String
  description      String
  category         Category @relation(fields: [categoryId], references: [id])
  categoryId       String
  topic            String
  date_added       DateTime @default(now())
  difficulty       String
  tags             String[]
  duration_minutes Int      @default(0)
  user          User  @relation(fields: [userId], references: [id])
  userId        String
  todos           Todo[]
}

model Todo {
  id                String     @id @default(uuid())
  title             String
  content           String?    @db.Text
  status            TodoStatus @default(ONGOING)
  priority          Int        @default(3)
  order             Int        @default(0)
  dueDate           DateTime?
  estimatedDuration Int?
  completedAt       DateTime?

  user           User     @relation(fields: [userId], references: [id])
  userId         String
  category       Category? @relation(fields: [categoryId], references: [id])
  categoryId     String?
  itemId         String?
  item           Item?    @relation(fields: [itemId], references: [id])

  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
}

model DailyActivity {
  id        String   @id @default(uuid())
  userId    String
  date      DateTime @db.Date
  points    Int      @default(0)
  itemsCount Int     @default(0)

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([userId, date])
  @@index([userId])
  @@index([date])
}

model Badge {
  id          String       @id @default(cuid())
  name        String
  description String
  icon        String
  category    BadgeCategory
  criteria    Json
  points      Int          @default(0)
  createdAt   DateTime     @default(now())

  earnedBadges UserBadge[]

  @@index([category])
  @@index([points])
}

model UserBadge {
  id          String   @id @default(cuid())
  userId      String
  badgeId     String
  earnedAt    DateTime @default(now())

  user    User   @relation(fields: [userId], references: [id], onDelete: Cascade)
  badge   Badge  @relation(fields: [badgeId], references: [id], onDelete: Cascade)

  @@unique([userId, badgeId])
  @@index([userId])
  @@index([earnedAt])
  @@index([userId, earnedAt])
}
